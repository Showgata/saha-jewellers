<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html  xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:th="http://www.thymeleaf.org" 
    xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    
   <head th:replace="common/common-header :: common-headpage"></head> 
    <body class="fixed-left" style="overflow-y: scroll;">
 
        <div id="wrapper" >

            <!--top bar-->
            <div th:replace="/common/common-header :: common-topbar"></div>
			<div th:replace="/common/common-header :: common-side-menu"></div>
			
            <div class="content-page  equal-height" >
                <div class="content">
                    <div class="container">
                        <div class="row">
                             <div class="col-sm-4 h6" style="margin-top:-10px;">
							  <div class="panel-box">
							  <h5>Customer Information</h5>
							  <div id="wizard" class="bwizard">
                                        <!-- Start .bwizard -->
                                     	
                                     	<!-- For updating purpose  -->
                                     	<input type="hidden" id="update_id" th:value=${voucherId}/>
                                     	<input type="hidden" id="update_type" th:value=${type}/>
                                     	<input type="hidden" id="update_mode"/>
                                     	<input type="hidden" id="update_prev_id"/>
                                     	<input type="hidden" id="total_paid_balance"/>
                                     	<input type="hidden" id="total_paid_interest_balance"/>
                                     
                                        <form class="form-horizontal" role="form">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab1">
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Customer name</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled  id="customer_name" placeholder="customer name" name="customer_name" type="text">
                                                        </div>
                                                    </div>
                                                    <!-- End .control-group  -->
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Id</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0" id="customer_id" name="customer_id" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Mobile number</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled id="cust_phone"  placeholder="phone number" name="phone_number" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Address</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled id="cust_address" placeholder="address" name="address" type="text">
                                                        </div>
                                                    </div>
													<div class="form-group col-sm-12" style="">
											<button type="button" class="btn btn-border-theme btn-xs" id="showProducts" data-toggle="modal"  data-target="#productModal">Product</button> 
											<button type="button" class="btn btn-border-theme btn-xs" data-toggle="modal"  data-target="#myModal">Transaction Details</button> 	
											<!--  <a href="#" class="btn btn-border-theme btn-xs" id="up">Update</a>-->									
										</div>	

                                                                                                        
                                                    
													<!-- End .control-group  -->
                                                </div>
                                              
                                               
                                            </div>
                                        </form>
										
                                    </div>
							  </div> </div>
                           
                              <div class="col-sm-4 h6" style="margin-top:-10px;">
                                 <div class="panel-box">
                                    <h5> Loan Transaction</h5>
                                     <div id="wizard" class="bwizard">
                                        <!-- Start .bwizard -->
                                     
                                        <form class="form-horizontal" role="form">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab1">
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Total Loan Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input id="tot_loan_amnt" disabled class="form-control" placeholder="0.00" name="total_loan_amount" type="text">
                                                        </div>
                                                    </div>
                                                    <!-- End .control-group  -->
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Previous Loan Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" name="prev_loan_amount" id="prev_loan_amount" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Paid Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control"  placeholder="0.00" name="paid_amount" id="paid_amount" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Due Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" name="due_amount" id="due_amount"  type="text">
                                                        </div>
                                                    </div>
													</div>   
                                            </div>
                                        </form>
                                       
                                    </div>

                                </div>
								 <div class="panel-box">
                                    <h5>Interest Transaction</h5>
                                     <div id="wizard" class="bwizard">
                                        <!-- Start .bwizard -->
                                     
                                        <form class="form-horizontal" role="form">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab1">
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Total Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="total_interest_amount" name="total_interest_amount" type="text">
                                                        </div>
                                                    </div>
                                                    <!-- End .control-group  -->
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Previous Interest paid Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="prev_interest_paid" name="prev_interest_paid" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Paid Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" placeholder="0.00" id="paid_interest_amount" name="paid_interest_amount" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Due Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" name="due_interest_amount" id="due_interest_amount" type="text">
                                                        </div>
                                                    </div>
													
                                                  
                                                    
                                                                                                        
                                                    
													<!-- End .control-group  -->
                                                </div>
                                              
                                               
                                            </div>
                                        </form>
                                        <!--<ul class="pager">
                                            <li class="previous"><a href="#">&larr; Back</a>
                                            </li>
                                            <li class="next"><a href="#">Next &rarr;</a>
                                            </li>
                                            <li class="next finish" style="display:none;"><a href="#">Finish</a>
                                            </li>
                                        </ul>-->
                                    </div>

                                </div>
								
                            </div > 
							
							<div>
						
                                                        
                                                    
							</div>
								<div class="col-sm-4 h6"  style="margin-top:-10px;">
                                <label class="col-lg-2 col-md-3 control-label" style="margin-top:30px;" >Delivery Date</label>
                                                        <div class="col-lg-10 col-md-9" style="margin-top:20px;">
                                                            <input class="form-control" placeholder="dd/mm/yyyy" id="date" name="date" type="text">
                                                        </div>
                                                        <div class="col-lg-12 col-md-9 form-group has-warning">
                                                            <input class="form-control input-lg "  id="voucher_id" style="color:#f7b03e;padding:12px; font-size: 28px;" placeholder="voucher id" name="firstname" type="text">
                                                        </div>
                                                        
                                                        <input type="hidden" id="trans_id" name="trans_id">
								<div class="panel-box">
								  <h5> Transaction Details</h5>
								 	
								 <div id="wizard" class="bwizard" >
                                        <!-- Start .bwizard -->
                                     
                                        <form class="form-horizontal" role="form">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab1">
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label"  style="font-size: 12px;"><font>Total Loan Amount</font></label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="totalLoanAmount" name="totalLoanAmount" type="text">
                                                        </div>
                                                    </div>
                                                    <!-- End .control-group  -->
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label" style="font-size: 12px;">Total Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="totalInterestAmount" name="totalInterestAmount" >
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label" style="font-size: 10px;">Total Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="totalAmount" name="totalAmount" type="text">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Paid Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="paidAmount" name="paidAmount" type="text">
                                                        </div>
                                                    </div>
      <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Paid Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="paidInterestAmount" name="paidInterestAmount" type="text">
                                                        </div>
                                                    </div>
                                                   <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Due Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="dueAmount" name="dueAmount" type="text">
                                                        </div>
                                                    </div>
                                                      <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Due Interest Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled id="dueInterestAmount" placeholder="0.00" name="dueInterestAmount" type="text">
                                                        </div>
                                                    </div>                                                   
                                                     <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Net Amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="0.00" id="netAmount" name="netAmount" type="text">
                                                        </div>
                                                    </div>
                                                    
                                                 
													
										
											<ul class="pager">
											<div id="component1">
											<a href="#" class="btn btn-border-theme btn-xs" id="save">Save</a> 
											<a href="#" class="btn btn-border-theme btn-xs" id="delivery">Delivery</a> 
											<a href="#" class="btn btn-border-theme btn-xs" id="cancel">Cancel</a> 
											<a href="#" class="btn btn-border-theme btn-xs" id="print">Print</a> 
											<a href="#" class="btn btn-border-theme btn-xs" id="pdf">PDF</a> 
											</div>
											
											<div id="component2">
											<a href="#" class="btn btn-border-theme btn-xs" id="update">Update</a> 
											
											<a href="#" class="btn btn-border-theme btn-xs" id="can">Cancel</a> 
											
											</div>
											</ul>
											
									
										
										
											
										
										
										
											
											
													<!-- End .control-group  -->
												
                                                </div>
                                              
                                               
                                            </div>
                                        </form>
                                        <!--<ul class="pager">
                                            <li class="previous"><a href="#">&larr; Back</a>
                                            </li>
                                            <li class="next"><a href="#">Next &rarr;</a>
                                            </li>
                                            <li class="next finish" style="display:none;"><a href="#">Finish</a>
                                            </li>
                                        </ul>-->
                                    </div>
								</div>
							
								</div>
								
							
                        </div>
						  <div class="row">
<div class="col-sm-4 h6"  style="margin-top:-375px;">
                                <div class="panel-box">
                                    <h5>Mortgage Information </h5>
                                    <div id="wizard" class="bwizard">
                                        <!-- Start .bwizard -->
                                     
                                        <form class="form-horizontal" role="form">
                                            <div class="tab-content">
                                                <div class="tab-pane active" id="tab1">
                                                   
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Interest rate</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="Int rate" name="intereset_rate" id="rate" type="text">
                                                        </div>
                                                    </div>
                                                     <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Loan amount</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="loan amt" name="loan_amount" id="loan_amount" type="text">
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- MODIFICATION  ====================== -->
                                                    
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Receive Date</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled placeholder="Receive Date" name="receive_date" id="receive_date" type="text">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">Customer Serial No</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled  placeholder="Customer Serial No" name="cust_serialNo" id="cust_serialNo" type="text">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label class="col-lg-2 col-md-3 control-label">No Of Days</label>
                                                        <div class="col-lg-10 col-md-9">
                                                            <input class="form-control" disabled  placeholder="No Of Days" name="no_Of_days" id="no_Of_days" type="text">
                                                        </div>
                                                    </div>
                                                                                                        
                                                    
													<!-- End .control-group  -->
                                                </div>
                                              
                                               
                                            </div>
                                        </form>
                                        <!--<ul class="pager">
                                            <li class="previous"><a href="#">&larr; Back</a>
                                            </li>
                                            <li class="next"><a href="#">Next &rarr;</a>
                                            </li>
                                            <li class="next finish" style="display:none;"><a href="#">Finish</a>
                                            </li>
                                        </ul>-->
                                    </div>
                                    <!-- End .bwizard -->
                                </div>
                            </div><!--height-->
                    
                          
							 <div class="col-sm-4 h6 " style="margin-top:-330px;">
                               
                                  
								
								
                            </div >
</div>
                    </div><!--content-->               
					</div><!--content page-->
            </div><!--end wrapper-->
            <div class="modal fade" id="myModal" role="dialog">
			<div class="modal-dialog modal-lg" style="width:90%;">

				<!-- Modal content For Transaction Details-->
				<div class="modal-content modal_dialog">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Loan Transactions <span>for voucher : <span id="vid"></span></span></h4> 
					</div>
					<div class="modal-body">

						<div class="form-group ">
							<table class="table table-striped" id="loanTransaction_tbl">
								<thead>
									<tr>
										<th id="thdate">Reminder Date</th> 
										<th>Storage</th>
										<th>Note</th>
										<th>Gram</th>
										<th>Bori</th>
										<th>Ana</th>
										<th>Ratti</th>									
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						</div>
						<div class="panel-group"></div>
						<ul class="pager">
							<li class="previous"><a href="#"
								onclick="javascript:toggleModal()" data-toggle="modal">Close
									&rarr;</a></li>
						</ul>
					</div>
					
				</div>

			</div>
			
			
			
			
			
		<div class="modal fade" id="productModal" role="dialog">
			<div class="modal-dialog modal-sm" style="width:50%;">			
			<!-- Modal content For Product Details-->
					<div class="modal-content modal_dialog">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Products Details <span>for voucher : <span id="vid"></span></span></h4> 
					</div>
					<div class="modal-body">

						<div class="form-group ">
							<table class="table table-striped" id="product_details_tbl">
								<thead>
									<tr>
										<th id="thdate">Product Name</th> 
										<th>Product Quantity</th>
																		
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						</div>
						<div class="panel-group"></div>
						<ul class="pager">
							<li class="previous"><a href="#"
								onclick="javascript:toggleProductModal()" data-toggle="product_modal">Close
									&rarr;</a></li>
						</ul>
					</div>
			
			</div>

			</div>
		
			
			
			
			
			
			
			
			
			
			
		</div>	
				
       <div th:replace="/common/common-header :: common-required-scripts"></div>
        <script src="/js/check.js"></script>
       <script type="text/javascript" src="/js/SumById.js"></script>
       <script type="text/javascript" src="/js/loan_transaction.js"></script>
       
       
 <!-- used to update balance all the time  -->
			<input type="submit" id="#edit-submit" class="abc" style="display:none"> 
 <div style="display:none">
 <form action="" class="form-inline">
  <center>  <div class="form-group">
    	<label>Cash-in:</label>
        <input type="text" id="dt_in" disabled="" class="form-control" placeholder="Cash-in">
    </div>
    <div class="form-group">
    </div>
    <div class="form-group">   
    	<label>Cash-out:</label> 
         <input type="text" id="dt_out" disabled="" class="form-control" placeholder="Cash-out">   
    </div>
    <div class="form-group">
    </div>
    <div class="form-group">
    	<label>Balance:</label>    
         <input type="text" id="dt_bal" disabled="" class="form-control" placeholder="Balance">   
         
           
          
    </div>
   
</center>
</form>
</div>
   <script src="/js/cashledger/cashledger.js"></script>
   <!-- used to update balance all the time  -->
       
       
       
       <script>
       
   
       
       
       
    	
    	
	$(document).ready(function(){
		
		$("#voucher_id").focus();
		updateTransaction();
	});
	
	$("#voucher_id").focusout(function(){
		$("#paid_amount").focus();
	});
	
	$("#paid_amount").focusout(function(){
		$("#paid_interest_amount").focus();
	});
	
	$("#paid_interest_amount").focusout(function(){
		$("#save").focus();
	});
	
	$("#save").keypress(function(e) {
	    if(e.which == 13) {
	        saveVoucher();
	        
	        
	    }
	    
	    $("#voucher_id").focus();
	});
       
		//whenever show product is clicked 
		$("#showProducts").click(function(){
			
		});
       
       var dataTable = null;
       $(document).ready(function () {
		   setAutoComplete();
		   reset();
		  // $("#loanTransaction_tbl").DataTable();
       });
       
       function toggleModal(){
       	$('#myModal').modal('toggle');
       }
       
       function toggleProductModal(){
          	$('#productModal').modal('toggle');
          }
      
       //==================================
    	   
    	   var setDataTableInProductDetails = function(respJson)
  		   	{
    		   				setNoOfDays(respJson.date,moment(date,"DD/MM/YYYY"));	 
    		   
    		   				var items=splitProductString(respJson);
  		       	    		 
  		       	    		
  		       	    		 
  		       	    		$('#product_details_tbl').DataTable().destroy();
  		       	    		 
  		       	    		 
  		       	    		 
  		       	    		$('#product_details_tbl').DataTable( {
  		       	        		data: items,
  		       	        		columns: [
  		       	            		{ title: "Product Name"},
  		       	            		{ title: "Product Quantity"}
  		       	            		
  		       	        			]
  		       	    			} );
  		       	    	 }
    	   
    	   
    	   var splitProductString =function(respJson)
    	   {
    		   var items = [];
    		   let splitByComma = (respJson.product.productName).split(",");
    		   
    		   console.log(splitByComma);
    		   
    		   $.each(splitByComma,function(i,val){
    			   
    			   
    			   if(val.trim()!=""){
    				   let splitByColon = val.split(":");
        			   
    				   if(splitByColon[0]!="" || splitByColon[1] !=""){
    					   
    					   var eachItem = [
            				   splitByColon[0],
            				   splitByColon[1]
        	       	    	 		];
            			   
            			   items.push(eachItem);
    					  
    					   
    				   }
        			   
    			   }
    			   
    			   
    		   })
    		   
    		   console.log(items);
    		   
    		   return items;
    		   
    		   
    	   }
    	   
    	   var setNoOfDays=function(receiveDate,transDate)
    	   {
    		   let old = moment(receiveDate); 
	    	   		let today =moment(transDate, "DD/MM/YYYY"); ; 
	    	   		let noOfDays = today.diff(old,"days"); 
	    	   		
	    	   		
	    	   		/*no of days */
	    	   		$("#no_Of_days").val(noOfDays);
    	   }
    	   
    	   
    	   //update transaction details
    	   var setDataTableInTransactionDetails = function(respJson)
  		       	    	 {
  		       	    		 var items = [];
  		       	    		 
  		       	    		//setNoOfDays(respJson.date);
  		       	    		 
  		       	    		$('#loanTransaction_tbl').DataTable().destroy();
  		       	    		 
  		       	    		 var eachItem = [
  		       	    			respJson.transaction.reminderDate+"",
  		       	    			respJson.transaction.storage,
  		       	    			respJson.transaction.note,
  		       	    		 	respJson.mortgage.gram,
  		       	    		respJson.mortgage.bori,
  		       	    	respJson.mortgage.ana,
  		       	   respJson.mortgage.ratti
  		       	    	 		]
  		       	    		 
  		       	    		 items.push(eachItem);
  		       	    		 
  		       	    		 
  		       	    		$('#loanTransaction_tbl').DataTable( {
  		       	        		data: items,
  		       	        		columns: [
  		       	            		{ title: "Remainder Date" },
  		       	            		{ title: "Storage" },
  		       	            		{ title: "Note" },
  		       	            		{ title: "Gram" },
  		       	            		
  		       	            	{ title: "Bori" },
  		       	           { title: "Ana" },
  		       	      { title: "Ratti" }
  		       	        ]
  		       	    } );
  		       	    	 }
       //==================================
    /*   function setLoanTransactionList(loantransactionList){
    	   
    	   let data = [];
    	   $("#vid").text(loantransactionList[0].voucherId);
    	   
    	   
    	   
    	   
    	   jQuery.each(loantransactionList, function(i, voucher) {
    		   
    		   //noOfDaysHasBeen Since the voucher was created
    		   
    		  
    		   
 	    	   
 	    	   
    		   data.push([voucher.transaction.reminderDate,
    			   voucher.transaction.storage,
    			   voucher.transaction.note,
    			   voucher.mortgage.gram,noOfDays]);
    		   
    	   });
    	  // jQuery('.dataTable').wrap('<div class="dataTables_scroll" />');
    	  if(dataTable != null){
    		  dataTable.destroy();
    	  }
    	   dataTable = $('#loanTransaction_tbl').DataTable({
       		  data: data,
               deferRender:    true,
               scrollY:        200,
               scrollCollapse: true,
               scroller:       true,
               "order": [],
			   "footerCallback": function ( row, data, start, end, display ) {
       var api = this.api(), data;

       // Remove the formatting to get integer data for summation
       var intVal = function ( i ) {
           return typeof i === 'string' ?
               i.replace(/[\$,]/g, '')*1 :
               typeof i === 'number' ?
                   i : 0;
       };
		
       let totalInterestAmount = api
       .column( 3 )
       .data()
       .reduce( function (a, b) {
           return intVal(a) + intVal(b);
       }, 0 );
       
       $("#totalInterestAmount").attr("data-init",totalInterestAmount);
       $("#totalInterestAmount").val(totalInterestAmount);
       
       let totalPaidAmount = api
       .column( 4 )
       .data()
       .reduce( function (a, b) {
           return intVal(a) + intVal(b);
       }, 0 );
       
       $("#paidAmount").attr("data-init",totalPaidAmount);
       $("#paidAmount").val(totalPaidAmount);
       
       let totalPaidInterestAmount = api
       .column( 5 )
       .data()
       .reduce( function (a, b) {
           return intVal(a) + intVal(b);
       }, 0 );
       
       $("#paidInterestAmount").attr("data-init",totalPaidInterestAmount);
       $("#paidInterestAmount").val(totalPaidInterestAmount);
       
       let totalDueAmount = api
       .column( 6 )
       .data()
       .reduce( function (a, b) {
           return intVal(a) + intVal(b);
       }, 0 );
       
       let totAmnt = parseFloat($("#tot_loan_amnt").val());
       $("#totalLoanAmount").attr("data-init",totAmnt)
       $("#totalLoanAmount").val(totAmnt);
       $("#totalAmount").val(roundTo(totAmnt+totalInterestAmount,2))
       
       $("#dueAmount").attr("data-init",totalDueAmount);
       $("#dueAmount").val(roundTo(totAmnt-totalPaidAmount,2));
       
       let totalDueInterestAmount = api
       .column( 7 )
       .data()
       .reduce( function (a, b) {
           return intVal(a) + intVal(b);
       }, 0 );
       
       $("#dueInterestAmount").attr("data-init",totalDueInterestAmount);
       $("#dueInterestAmount").val(totalDueInterestAmount);
       let netAmount = parseFloat($("#dueAmount").val())+parseFloat($("#dueInterestAmount").val());
       $("#netAmount").val(netAmount);
       // Total over all pages
      /*  total = api
           .column( 10 )
           .data()
           .reduce( function (a, b) {
               return intVal(a) + intVal(b);
           }, 0 );

       var rowsCount = api
       .column( 10 )
       .data().length; */
       
     /*   $("#voucher_count").val(rowsCount);
       $("#total_loan_amount").val(roundTo(total,2)); */
       // Total over this page
    /*    pageTotal = api
           .column( 10, { page: 'current'} )
           .data()
           .reduce( function (a, b) {
               return intVal(a) + intVal(b);
           }, 0 ); */

       // Update footer
    /*    $( api.column( 10 ).footer() ).html(
           '$'+pageTotal +' ( $'+ total +' total)'
       ); 
   }
       	});  
    	   
    	   
       }*/
       //========================================================================================
    	   
    	   
    	   
    	    let voucherObj={};
    let resObj ={};
    let mode = 0;
    
    /*
    	0 - Save Mode
    	1 - Update Mode
    */
    
    let flag = 0;
    
    /*
    	0 - Save Btn
    	1 - Delivery Btn
    */
    
    /*
    $("#delivery").click(function(){
    	
    	var retVal = confirm("Do you want to continue ?");
    	
    	if(retVal){
    	
    	let loanTransaction = {}; 
		 
 		var txt =$("#voucher_id").val(); 
 		//var subTxt = txt.substring(3,6);
        
 		console.log(txt);
 		 
        loanTransaction["flag"]=formatIntegerValue("1");
        loanTransaction["type"]=("mortgage");
 		 loanTransaction["voucherId"] = formatIntegerValue(txt);
 		 loanTransaction["dueAmount"] = formatFloatValue($("#due_amount").val());
 		 loanTransaction["paidAmount"] = formatFloatValue($("#paidAmount").val());
 		 loanTransaction["previousLoanAmount"] = formatFloatValue($("#prev_loan_amount").attr("data-init"));
 		 loanTransaction["transaction_amount"] = formatFloatValue($("#tot_loan_amnt").val());
 		 loanTransaction["date"] = $("#date").val();
 		 loanTransaction["interest_amount"] = formatFloatValue($("#paid_interest_amount").val());
 		 loanTransaction["interestDueAmount"] = formatFloatValue("0.00");
 		 loanTransaction["interestPaidAmount"] = formatFloatValue($("#paid_interest_amount").val());
 		 loanTransaction["interestPreviousLoanAmount"] = formatFloatValue($("#paid_interest_amount").val());
 		 
 		 
 		 
 		 let url = getAbsoluteUrl("mortgage-app/api/voucher/loan/");
 		 buildAjaxForJson(url, "POST", loanTransaction).then(function(respJson){
 			 
 			 alert("delivered LoanTransaction");
 			 console.log(respJson);
 			 reset();
 		 },function(reason){
		           	 console.log("error in processing your request while saving loanTransaction", reason);
       	});
    	
    	}
    	
    });
    	   */
    	   
    	  //========================================================================================= 
    	   $(document).ready(function(){
    		   //updateTransaction();
    	
    	$("#date").datepicker(dateSettings);	
    	$("#date").datepicker({
			   dateFormat: "dd/mm/yyyy",
			   onSelect: function(dateText) {
				   setNoOfDays(vDetails.date,dateText);
				   fillUpInterestTransactionFields(lDetails,vDetails,dateText,0);
				  }
		   });
    	
    	$("#date").val(moment().format("DD/MM/YYYY"));
    	
    	$("#save").attr("disabled",true);
  		$("#delivery").attr("disabled",true);
    	
    	
    		
    	setAutoComplete();
    	
    	$("#component2").hide();
    });
    
    
    var updatePrimaryFields =function(respJson,date)
    {
    	$("#cust_address").val(respJson.customer.address);
   	    $("#cust_phone").val(respJson.customer.mobile); 
   	    $("#customer_name").val(respJson.customer.customerName);
   	    $("#customer_id").val(respJson.customer.customerId);
   	    
   	 	$("#bori").val(respJson.mortgage.bori==null?"0.00":respJson.mortgage.bori);
  	    $("#ana").val(respJson.mortgage.ana==null?"0.00":respJson.mortgage.ana);
  	    $("#ratti").val(respJson.mortgage.ratti==null?"0.00":respJson.mortgage.ratti);
  	    $("#gram").val(respJson.mortgage.gram);
  	    $("#loan_amount").val(respJson.mortgage.loanAmount);
  	    $("#rate").val(respJson.mortgage.interestRate);
  	    $("#tot_loan_amnt").val(respJson.mortgage.loanAmount);
  	    
  	    //============modification
  	    $("#receive_date").val(moment(respJson.date).format("DD/MM/YYYY"));
  	    $("#cust_serialNo").val(respJson.transaction.transactionSerial);
   	    
   	    
   	  
   	   
   	    
   	 	let old = moment(respJson.createdDate,"DD/MM/YYYY"); 
	     	let today = moment(date,"DD/MM/YYYY"); 
	     	let diff = today.diff(old,"days");		       	 
   	    $("#days_count").val(diff);
    }
    
       
       
       //===========================================================================================
    	   
    	   function setAutoComplete(){
 	   
 	   var autoCompleteList = [];
 	   var URL = getAbsoluteUrl("mortgage-app/api/voucher/mortgage");
 	   
 	   buildAjax(URL, "GET").then(function(respJson){
 		   
 		   console.log(respJson);
 		   
 		   jQuery.each(respJson, function(i, val) {
 			   
 			   		if(val.customer!=null){
 			   			var str =val.id +" > "+ val.customer.customerName +" > "+moment(val.date).format("DD/MM/YYYY");
  				   		autoCompleteList.push({value: val.id,  label: str});
 			   		}
 			   		
 				   
 				   
 		   });
 		   
 	   
 		 $( "#voucher_id" ).autocomplete({
		        source: autoCompleteList,
		        select: function (event, ui) {
		        var txt = (ui.item.value);
		        
		        
		          let voucherId = parseInt(txt);
		          
		          $("#up").remove('disabled');
		          
		          $("#rate").focus();
		         // $("#cust_id").val(custId); 
		         
		         
		         //IMPORTANT
		          apiCall(voucherId);
		          
		          
		      }
		      })
 	   }, function(reason){
        	 console.log("error in processing your request customer", reason);
      	});
    }
    
    
    /*
    var apiCall =function(voucherId)
    {
    	var voucher = null;
    	buildAjax(getAbsoluteUrl("mortgage-app/api/voucher/"+voucherId), "GET").then(function(respJson){
	        //	 alert('success');
	        	
	        	let d = moment();
	         	updatePrimaryFields(respJson,d);
	         	setDataTableInTransactionDetails(respJson);
	         	setDataTableInProductDetails(respJson);
	       	 	voucherObj = respJson;
	       	    
	       	    
	       	 buildAjax(getAbsoluteUrl("mortgage-app/api/voucher/loan/"+voucherId),"GET").then(function(loanJson){
	       	    	 
	       	    	 
	       	    	 console.log(loanJson);
	       	    	 
	       	    	 
	       	    	let d=$("#date").val();
	       	    	
	       	    	 if(loanJson != null && loanJson.length>0){
	       	    		$("#thdate").click();
	       	    		resObj=loanJson; 
	       	    		calVariousInterest(loanJson,respJson,d);
       	    		 
	       	    	 } else {
	       	    		 		       	    		
	       	    		calFirstTimeInterest(respJson,d);
	       	    	 }
	       	    		
	       	    		
	       	 	},function(reason){
	           	 console.log("error in processing your request", reason);
           		})
	       	    
	         },function(reason){
	           	 console.log("error in processing your request", reason);
           	}); 
    }
 	   
	  
 	
 	var calFirstTimeInterest =function(respJson,date){
 		
 		$("#total_paid_balance").val("0.00");
 		
 		 $("#prev_loan_amount").val("0.00");
 		$("#prev_loan_amount").attr("data-init","0.00");
   		 $("#paid_amount").val("0.00");
   		 $("#due_amount").val(roundTo(respJson.mortgage.loanAmount,2));
   	     $("#due_amount").attr("data-init",respJson.mortgage.loanAmount);
   		 
   	 	 $("#tot_loan_amnt").val(respJson.mortgage.loanAmount);
   	     let old = moment(respJson.date,"DD/MM/YYYY"); 
   	     let today = moment(date, "DD/MM/YYYY"); 
   	     let diff =  Math.abs(today.diff(old,"days"));

   	     console.log(diff);
   	     
	   	 	let dueAmt = parseFloat(respJson.mortgage.loanAmount);
	 		let totalAmt =parseFloat(respJson.mortgage.loanAmount);	      
	 		let paidAmt = Math.abs(totalAmt-dueAmt); 
	 		//let amount = parseFloat(dueAmt);
	 	
	 	
   	     let totalInterestAmnt = 0;
   	     let paidInterest =0;		       	    	   
   	     //let prePaidInterest=0;
   	     
   	     let rate = parseFloat(respJson.mortgage.interestRate);
   	     
   	     
   	     if((diff-31)>0){
   	    	let noOfDays = (diff-31);
   	        totalInterestAmnt = (rate*dueAmt*noOfDays)/100;
   	   		
   	   		//prePaidInterest=(rate*paidAmt*noOfDays)/100;
   	     }else
	     {
   	    	let noOfDays = (diff);
   	    	console.log("noOfDays => "+noOfDays);
   	        totalInterestAmnt = (rate*dueAmt)/100;
   	    	
   	    	//prePaidInterest=(rate*paidAmt)/100;
   	     }
   	     
   	     
   	$("#total_interest_amount").val(roundTo(totalInterestAmnt,2));	       	    		 
	 $("#prev_interest_paid").val("0.00");
	 $("#paid_interest_amount").val("0.00");
	 $("#due_interest_amount").val(roundTo(totalInterestAmnt,2));
     $("#due_interest_amount").attr("data-init",roundTo(totalInterestAmnt,2));
     
     $("#totalLoanAmount").val(roundTo(respJson.mortgage.loanAmount,2));
     $("#totalLoanAmount").attr("data-init",respJson.mortgage.loanAmount);
     $("#totalInterestAmount").val(roundTo(totalInterestAmnt,2));
     $("#totalInterestAmount").attr("data-init",totalInterestAmnt);
     $("#totalAmount").val(roundTo(totalInterestAmnt+respJson.mortgage.loanAmount,2));
     $("#paidAmount").val("0.00");
     $("#paidInterestAmount").val("0.00");
     $("#paidInterestAmount").attr("data-init","0.00");
     $("#paidAmount").attr("data-init","0.00");
     $("#dueAmount").val(roundTo(dueAmt,2));
     $("#dueInterestAmount").val(roundTo(totalInterestAmnt,2));
     $("#netAmount").val("0.00");
   		 
     $("trans_id").val("0.00");	   
 	}
    
 	
 	
 	
 	
    
    var calVariousInterest = function(loanJson,respJson,date){
    	
    	
    	 $("#tot_loan_amnt").val(respJson.mortgage.loanAmount);
  		 //===============================modification
  	     //setLoanTransactionList(respJson);
  		 $("#total_paid_balance").val("0.00");
  		
  			
  	     $("#thdate").click();
  	     
  		 let loanTransaction = loanJson[0];
  		 console.log(loanTransaction);
  		 
  		 //=================================================================== 
  			 
  		let dueAmt = parseFloat(loanTransaction.dueAmount);
  		let totalAmt =parseFloat(loanTransaction.transaction_amount);
	 		let paidAmt = Math.abs(totalAmt-dueAmt);
	 	
	 	
	 		let interestPaidAmount = parseFloat(loanTransaction.interestPaidAmount);
	 		
			let totalInterestAmt =parseFloat(loanTransaction.interest_amount);
	 		//let prePaidInterest = Math.abs(totalInterestAmt-dueInterest);
	 	
	 	
	 	
	 	
  	    $("#prev_loan_amount").val(paidAmt);
  	     $("#paid_amount").val("0.00");
  	     $("#due_amount").val(dueAmt);
  	     
  	     
  	     
  	     $("#due_amount").attr("data-init",dueAmt);
  	     
  	     
  		let rate = parseFloat(respJson.mortgage.interestRate);
  	    let old = moment(loanTransaction.date,"DD/MM/YYYY"); 
  	  	let today = moment(date, "DD/MM/YYYY");  
	     	let diff = today.diff(old,"days");
	     	let amount = parseFloat(dueAmt);
	 
  	     let totalInterestAmnt = 0;
  	     
	  	 if((diff-31)>0){
	    	let noOfDays = (diff-31);
	    	console.log("noOfDays => "+noOfDays);
	        totalInterestAmnt = (rate*dueAmt*noOfDays)/100;
	     	
	     	
	  
	     }else
	     {
	    	let noOfDays = (diff);
	    	console.log("noOfDays => "+noOfDays);
	        totalInterestAmnt = (rate*dueAmt)/100;

	     }
	  	 
	  	 console.log("loanTransaction.flag="+loanTransaction.flag);
	  	 
	  	 
	  	if(loanTransaction.flag === 0 || loanTransaction.flag == null ){
	  	let dueInterest =  parseFloat(totalInterestAmnt);
	  
	    var dueInterestAmount = loanTransaction.interestDueAmount;
	    	
	    	//roundTo(totalInterestAmnt-loanTransaction.interestPreviousLoanAmount,2) <= 0.00 ? "0.00":roundTo(totalInterestAmnt-loanTransaction.interestPreviousLoanAmount,2);

	     $("#total_interest_amount").val(roundTo(totalInterestAmnt,2));	       	    		 
		 $("#prev_interest_paid").val(loanTransaction.interestPaidAmount);
		 $("#prev_interest_paid").attr("data-init",loanTransaction.interestPaidAmount);
		 $("#paid_interest_amount").val("0.00");
		
		 
		 //check this
		 if(loanTransaction.interest_amount === totalInterestAmnt)
				 {
				 $("#due_interest_amount").val(dueInterestAmount); 
				 $("#due_interest_amount").attr("data-init",dueInterestAmount);
				 
				 $("#dueInterestAmount").val(dueInterestAmount);
				   $("#dueInterestAmount").attr("data-init",dueInterestAmount);
				 }else
					 
		 {
			 	$("#due_interest_amount").val(totalInterestAmnt); 
			 	$("#due_interest_amount").attr("data-init",totalInterestAmnt);
			 
			 	$("#dueInterestAmount").val(totalInterestAmnt);
			   $("#dueInterestAmount").attr("data-init",totalInterestAmnt);
			 
			 
			 }
	
   
   $("#totalLoanAmount").val(roundTo(respJson.mortgage.loanAmount,2));
   $("#totalLoanAmount").attr("data-init",respJson.mortgage.loanAmount);
   $("#totalInterestAmount").val(roundTo(totalInterestAmnt,2));
   $("#totalInterestAmount").attr("data-init",totalInterestAmnt);
   
   var totalAmount =roundTo(totalInterestAmnt+respJson.mortgage.loanAmount,2);
   
   
   
	   $("#totalAmount").val(totalAmount);
	   $("#paidAmount").val(loanTransaction.paidAmount);
	   $("#paidAmount").attr("data-init",loanTransaction.paidAmount)
	   $("#paidInterestAmount").val(loanTransaction.interestPaidAmount);
	   $("#paidInterestAmount").attr("data-init",loanTransaction.interestPaidAmount);
	   $("#dueAmount").val(roundTo(loanTransaction.dueAmount,2));
	   
	   $("#netAmount").val(loanTransaction.interestPaidAmount+loanTransaction.paidAmount);

	   $("#trans_id").val(loanTransaction.id);
   }else
   {
	   alert("Delivered Already !");
	   
	   $("#total_interest_amount").val(loanTransaction.interestPaidAmount);	       	    		 
		 $("#prev_interest_paid").val(loanTransaction.interestPaidAmount);
		 $("#prev_interest_paid").attr("data-init",loanTransaction.interestPaidAmount);
		 $("#paid_interest_amount").val("0.00");
		 
		 
		 $("#due_interest_amount").val("0.00"); 
		 $("#due_interest_amount").attr("data-init","0.00");
		 
		 $("#dueInterestAmount").val("0.00");
		   $("#dueInterestAmount").attr("data-init","0.00");
		 
		 $("#totalLoanAmount").val(roundTo(respJson.mortgage.loanAmount,2));
		   $("#totalLoanAmount").attr("data-init",respJson.mortgage.loanAmount);
		   $("#totalInterestAmount").val(roundTo(loanTransaction.interestPaidAmount,2));
		   $("#totalInterestAmount").attr("data-init",loanTransaction.interestPaidAmount);
	   
		
		   var totalAmount =roundTo(loanTransaction.interestPaidAmount+respJson.mortgage.loanAmount,2);
   
	   
	   $("#totalAmount").val(totalAmount);
	   $("#paidAmount").val(loanTransaction.paidAmount);
	   $("#paidAmount").attr("data-init",loanTransaction.paidAmount)
	   $("#paidInterestAmount").val(loanTransaction.interestPaidAmount);
	   $("#paidInterestAmount").attr("data-init","0.00");
	   $("#dueAmount").val(roundTo(loanTransaction.dueAmount,2));
	   
	   $("#netAmount").val(loanTransaction.interestPaidAmount+loanTransaction.paidAmount);

	   $("#trans_id").val(loanTransaction.id);
   }
   
   
  
    }
    
    
    
    //onchange
     
    ;(function(){
    	
    	$("#paid_amount").change(function(e){
 		   let paidAmount = parseFloat($(this).val()==""?"0.00":$(this).val());
 		   let dueAmount = parseFloat($("#due_amount").attr("data-init"));
 		   
 		  let totLoanAmount = parseFloat($("#totalLoanAmount").attr("data-init"));
		   let totInterestAmount = parseFloat($("#totalInterestAmount").attr("data-init"));
		   
		  
 		   
 		  var overallpaidAmt = ($("#total_paid_balance").val() === null ||$("#total_paid_balance").val() === "") ? 0.00 : parseInt($("#total_paid_balance").val()) ;
 		  console.log("overallpaidAmt "+overallpaidAmt);
 		  var amtLeft =  totLoanAmount - (overallpaidAmt);
 		   
 		  console.log("amt left = ");
 		 console.log(amtLeft);
 		  
 		 var updateMode =parseInt($("#update_mode").val());
 		  
 		  $("#prev_loan_amount").attr("data-init",paidAmount);
 		  
 		 	if(paidAmount>amtLeft && updateMode === 1){
 		  		$(this).val("0.00");
 		  		paidAmount=0;
 		  		alert("Paid Amount should be less than "+amtLeft );
 		  	}
 		  
 		  
 		   
 		  	if($("#due_amount").val()>=paidAmount){
 		  	 dueAmount =   dueAmount - paidAmount;
 		  	}else{
 		  		$(this).val("0.00");
 		  		paidAmount=0;
 		  		alert("Paid Amount cannot be more than Due Amount")
 		  	}
 		  	
 		  
 		  
 		 
 		  
 		  let overallAmount=roundTo(totLoanAmount+totInterestAmount,2);
 		   $("#totalAmount").val(overallAmount);
 		   
 		   $("#due_amount").val(roundTo(dueAmount,2));
 		   // totaldueAmount += dueAmount
 		   if($("#dueAmount").val()!="" && parseInt($("#dueAmount").attr("data-init"))>=paidAmount){
 			   dueAmount = parseFloat($("#dueAmount").attr("data-init"))-paidAmount;
 		   }
 		   //total due Amount
 		   $("#dueAmount").val(roundTo(dueAmount,2));
 		  
 		  // $("#dueAmount").attr("data-init",roundTo(dueAmount,2))
 		   //totalPaidAmount
 		   if($("#paidAmount").val()!=""){
 			  paidAmount = parseFloat($("#paidAmount").attr("data-init"))+paidAmount;
 		   }
 		   $("#paidAmount").val(roundTo(paidAmount,2));
 		  	$("#prev_loan_amount").val(roundTo(paidAmount,2));
 		  	//use this
 		   //netAmount
 		   let intDueAmount = parseFloat($("#dueInterestAmount").val()==""?"0.00":$("#dueInterestAmount").val());
 		   $("#netAmount").val(roundTo(overallAmount-(dueAmount+intDueAmount)),2);
 		   
 		  
 		   
 		   
 		   
 		   
 	   });
 	   
    	
    	
    	
    	
    	
 	   $("#paid_interest_amount").change(function(){
 		   
 		   let paidInterestAmount = parseFloat($(this).val()===""?"0.00":$(this).val());
 		   let dueInterestAmount = parseFloat($("#due_interest_amount").attr("data-init"));
 		   
 		   
 		  
 		  
 		  
 		  if($("#due_interest_amount").val()!="" && parseFloat($("#due_interest_amount").attr("data-init")) >= paidInterestAmount){
 			 $("#prev_interest_paid").attr("data-init",paidInterestAmount);
 			 dueInterestAmount = dueInterestAmount - paidInterestAmount;
 		  }else{
 			  alert("Paid Interest should be less than Due Interest..");
 			 paidInterestAmount=0.0;
 			$(this).val("0.00");
 		  }
 		    		
 		   $("#due_interest_amount").val(roundTo(dueInterestAmount,2));
 		  $("#dueInterestAmount").val(roundTo(dueInterestAmount,2));
 		   //tot amount
 		   let totLoanAmount = parseFloat($("#totalLoanAmount").attr("data-init"));
 		   let totInterestAmount = parseFloat($("#totalInterestAmount").attr("data-init"));
 		   
 		   
 		  let overallAmount=roundTo(totLoanAmount+totInterestAmount,2);
 		   $("#totalAmount").val(overallAmount);
 		   
 		   if($("#paidInterestAmount").val()!=""){
 			   paidInterestAmount+= parseFloat($("#paidInterestAmount").attr("data-init"));
 		   }
 		   //totpaidInterestAmount
 		   $("#paidInterestAmount").val(roundTo(paidInterestAmount,2));
 		  $("#paidInterestAmount").attr("data-init",roundTo(paidInterestAmount,2))
 		  	$("#prev_interest_paid").val(roundTo(paidInterestAmount,2));
		  	
 		   //$("#paidInterestAmount").attr("data-init",paidInterestAmount);
 		   //totdueInterestAmount
 		   
 		   //if($("#dueInterestAmount").val()!="" && parseFloat($("#dueInterestAmount").attr("data-init")) >= paidInterestAmount){
 			   //dueInterestAmount = parseFloat($("#dueInterestAmount").attr("data-init")) - paidInterestAmount;
 		   //}
 		  
 		   
 		   let dueAmount = parseFloat($("#due_amount").val());
 		   $("#netAmount").val(roundTo(overallAmount-(dueAmount+dueInterestAmount)),2);
 	   });
 	   
 	   
 	   
    
    
    
    })();*/
 
    
/*
    var saveOrUpdate = function(mode){
    	   
    	   let loanTransaction = {}; 
    	 
    	var txt =$("#voucher_id").val(); 
    	
       console.log("Voucher ID"+txt);
       
       if($("#update_id").val().trim()!="")
       {
    	   loanTransaction["id"]=parseInt($("#update_id").val().trim());
       }
    	 
       loanTransaction["flag"]=formatIntegerValue("0");
       loanTransaction["type"]="mortgage";
    	 loanTransaction["voucherId"] = formatIntegerValue(txt);
    	 loanTransaction["dueAmount"] = formatFloatValue($("#due_amount").val());
    	 loanTransaction["paidAmount"] = formatFloatValue($("#paidAmount").val());
    	 loanTransaction["previousLoanAmount"] = formatFloatValue($("#prev_loan_amount").attr("data-init"));
    	 loanTransaction["transaction_amount"] = formatFloatValue($("#tot_loan_amnt").val());
    	 loanTransaction["date"] = $("#date").val();
    	 loanTransaction["interest_amount"] = formatFloatValue($("#total_interest_amount").val());
    	 loanTransaction["interestDueAmount"] = formatFloatValue($("#due_interest_amount").val());
    	 loanTransaction["interestPaidAmount"] = formatFloatValue($("#paidInterestAmount").val());
    	 loanTransaction["interestPreviousLoanAmount"] = formatFloatValue($("#prev_interest_paid").attr("data-init"));
    	 
    	 console.log(loanTransaction);
    	 let url = getAbsoluteUrl("mortgage-app/api/voucher/loan/");
    	 buildAjaxForJson(url, "POST", loanTransaction).then(function(respJson){
    		 
    		 
    		 
    		 if(mode === 1)
    			 {
    			 	
    				$("#component1").show(400);
    				$("#component2").hide();
    				 
    				$("#up").show();
    				$("#voucher_id").removeAttr("disabled");
    				alert("updated LoanTransaction");
    			 }
    		 else{
    			alert("saved LoanTransaction");
    			 reset();
    		 }
    		 
    		 console.log(respJson);
    		
    	 },function(reason){
    	           	 console.log("error in processing your request while saving loanTransaction", reason);
      	}); 
    	   
    	   
    	   
    }

    $("#save").click(function(e){
    	saveOrUpdate(0);
    })
    
    
     $("#cancel").click(function(){
    	reset();
    });
    	
    
    */
    var updateTransaction =function()
    {
    	if($("#update_id").val().trim()!="" && $("#update_type").val().trim()!=""){
 		   			
    				var id =parseInt($("#update_id").val().trim());
    				var type =$("#update_type").val().trim().split("/")[0]; 
    		
    				console.log(id+"======="+type);
    		
              		var URL =getAbsoluteUrl("mortgage-app/api/voucher/updateByIDAndType"); 
              		
              		$.ajax({
              	     type: "GET",
              	     url: URL,
              	   data:{id,type},
              	    success: function(respJson) {

              	    	console.log(respJson);
              	    	
              	    	var voucherDetails = respJson[0][1];
              	    	var loanDetails = respJson[0][0];
              	    	
              	    	lDetails =loanDetails;
              	    	vDetails = voucherDetails;
              	    	
              	    	console.log(voucherDetails);
              	    	
              	    	getSumById(voucherDetails.id);
              	    	getSumInterestById(voucherDetails.id);
              	    	$("#update_mode").val(1);
              	    	updatePrimaryFields(voucherDetails,voucherDetails.date);
              	    	setNoOfDays(voucherDetails.date,loanDetails.date);
              	    	setDataTableInTransactionDetails(voucherDetails);
        	         	setDataTableInProductDetails(voucherDetails);             	    	
        	         	//setLoanTransData(loanDetails,voucherDetails);
        	         	fillUpLoanTransaction(loanDetails,voucherDetails,1);
        	         	$("#voucher_id").val(voucherDetails.id);
        	         	$("#save").removeAttr('disabled');
        	 			$("#delivery").removeAttr('disabled');
        	         	
        	         	
        	         	
              	  		}  
              	})
   

    		
 	   }else{$("#update_mode").val(0);}
    }
    
    
   
    /*
    var setLoanTransData =function(loanJson,voucherDetails)
    {
    	
   	 	var value = v1+loanJson.previousLoanAmount;
   		$("#total_paid_balance").val(value);
   		console.log("update trans");
   		console.log(value);
    	
    	updateTransactionFields(loanJson,voucherDetails);
    	
    	let dueAmt =parseFloat(loanJson.dueAmount+loanJson.previousLoanAmount);
    	
    	var pa = parseFloat(loanJson.transaction_amount - dueAmt);
    	let prevAmnt = pa>0 ? pa:0;
    	let rate = parseFloat(respJson.mortgage.interestRate);
    	
    	
    	
    	 	$("#due_interest_amount").val(loanDetail.interestDueAmount);
    	   $("#paid_amount").val(loanDetail.paidAmount);
    	   $("#prev_loan_amount").val(loanDetail.previousLoanAmount);
    	   $("#tot_loan_amnt").val(loanDetail.interest_amount);
    	   $("#total_interest_amount").val(loanDetail.interest_amount);
    	   $("#due_interest_amount").val(loanDetail.interestDueAmount);
    	   $("#paid_interest_amount").val(loanDetail.interestPaidAmount);
    	   $("#prev_interest_paid").val(loanDetail.interestPreviousLoanAmount);
    	   
    	   
    	   $("#totalLoanAmount").val("");
       		$("#totalInterestAmount").val("");
       		$("#paidInterestAmount").val("");
       		$("#dueInterestAmount").val("");
       		$("#paidAmount").val("");
       		$("#totalAmount").val("");
       		$("#dueAmount").val(dueAmt);
       		$("#netAmount").val("");
       		
    }*/
    
    
    
    $("#save").click(function(e){
    	saveOrUpdate("mortgage",0);
    });

    $("#delivery").click(function(e){
    	deliveryBtn("mortgage");
    });

    	   
       
       //=======================================================================================================
      
       
       </script>
       
      <!--  <script type="text/javascript" src="/js/deliveryTrans.js"></script>-->
      
    </body>

<!-- Mirrored from psd2allconversion.com/templates/templatemonster/html/pink-desh/dark/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 28 Jun 2018 06:31:07 GMT -->
</html>
